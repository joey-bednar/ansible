- name: Install dotfiles dependencies
  become: true
  ansible.builtin.apt:
    name:
      - fzf
      - stow
      - fontconfig
      - make
    state: present

- name: Download dotfiles # noqa latest
  ansible.builtin.git:
    repo: https://github.com/joey-bednar/dotfiles
    dest: "{{ home_dir }}/dotfiles"
    clone: true
    update: true
    force: true

- name: Make dotfiles
  ansible.builtin.shell: |
    cd {{ home_dir }}/dotfiles
    make update
    make setup
  changed_when: true

- name: Search for custom font
  ansible.builtin.shell: fc-list | grep -q Nerd
  register: font_check
  ignore_errors: true
  changed_when: false

- name: Load custom font
  ansible.builtin.command: fc-cache -f -v
  when: font_check.rc != 0
  changed_when: font_check.rc != 0

- name: Create personal directory
  ansible.builtin.file:
    path: "{{ home_dir }}/personal"
    state: directory
    mode: "0755"

- name: Create work directory
  ansible.builtin.file:
    path: "{{ home_dir }}/work"
    state: directory
    mode: "0755"
